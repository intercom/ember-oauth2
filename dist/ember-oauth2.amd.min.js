/** ember-oauth2 | @version 1.1.0 | 09-03-2017 */
define("ember-oauth2",["ember","exports"],function(a,b){"use strict";var c=a.default;b.default=c.Object.extend(c.Evented,{init:function(){if(this._super(),c.OAuth2&&c.OAuth2.config&&Object.keys(c.OAuth2.config).length)c.Logger.warn("Ember.OAuth2.config is deprecated and will be removed in future versions. Set the config using window.ENV['ember-oauth2']"),this.set("config",c.OAuth2.config);else if(window.EmberENV&&window.EmberENV["ember-oauth2"])this.set("config",window.EmberENV["ember-oauth2"]);else{if(!window.ENV||!window.ENV["ember-oauth2"])throw new Error("Cannot find the ember-oauth2 config.");this.set("config",window.ENV["ember-oauth2"])}if(!this.get("config")[this.get("providerId")])throw new Error("Cannot find the providerId: '"+this.get("providerId")+"' in the config.");this.set("providerConfig",this.get("config")[this.get("providerId")]),this.set("statePrefix","state"),this.set("tokenPrefix","token"),this.set("responseType","token"),this.setProperties(this.providerConfig),this.on("redirect",this.handleRedirect)},version:function(){return d},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})},now:function(){return Math.round((new Date).getTime()/1e3)},requestObj:function(){var a={};return a.response_type=this.get("responseType"),a.providerId=this.get("providerId"),a.client_id=this.get("clientId"),a.state=this.generateState(),this.get("scope")&&(a.scope=this.get("scope")),a},authUri:function(){var a=this.get("authBaseUri");return a+="?response_type="+encodeURIComponent(this.get("responseType"))+"&redirect_uri="+encodeURIComponent(this.get("redirectUri"))+"&client_id="+encodeURIComponent(this.get("clientId"))+"&state="+encodeURIComponent(this.get("state")),this.get("scope")&&(a+="&scope="+encodeURIComponent(this.get(".scope")).replace("%20","+")),a},authorize:function(){if(!this.get("providerId"))throw new Error("No provider id given.");if(!this.get("clientId"))throw new Error("No client id given.");if(!this.get("authBaseUri"))throw new Error("No auth base uri given.");if(!this.get("redirectUri"))throw new Error("No redirect uri given.");return this.clearStates(),this.saveState(this.requestObj()),this.openWindow(this.authUri())},openWindow:function(a){var b=600,d=800,e=window.screen.width/2-b/2,f=window.screen.height/2-d/2,g="menubar, width="+b+", height="+d+", top="+f+", left="+e,h=window.open(a,"Authorize",g);return window.focus&&h&&h.focus(),new c.RSVP.Promise(function(a,b){h?a(h):b(new Error("Opening dialog login window failed."))})},authSuccess:function(a){return"token"===this.get("responseType")&&a.access_token||"code"===this.get("responseType")&&a.code},generateToken:function(a){var b={};return b.provider_id=this.get("providerId"),b.expires_in=this.expiresIn(a.expires_in),b.scope=this.get("scope"),b.access_token=a.access_token,b},generateState:function(){return this.get("state")||this.set("state",this.uuid()),this.get("state")},expiresIn:function(a){return this.now()+parseInt(a,10)},handleRedirect:function(a,b){var c=this,d=c.parseCallback(a);c.authSuccess(d)&&c.checkState(d.state)?"token"===c.get("responseType")?(c.saveToken(c.generateToken(d)),c.verifyToken().then(function(a){c.trigger("success",d)},function(a){c.removeToken(),c.trigger("error","Error: verifying token",d)})):c.trigger("success",d.code):c.trigger("error","Error: authorization",d),b&&"function"==typeof b&&b()},verifyToken:function(){return c.RSVP.Promise.resolve(!0)},checkState:function(a){return!!a&&(a===this.readState().state?(this.removeState(this.stateKeyName()),!0):(c.Logger.warn("State returned from the server did not match the local saved state."),!1))},parseCallback:function(a){for(var b,c={},d=a.substring(a.indexOf("?")),e=/([^#?&=]+)=([^&]*)/g;null!==(b=e.exec(d));)c[decodeURIComponent(b[1])]=decodeURIComponent(b[2]);return c},saveState:function(a){window.localStorage.setItem(this.stateKeyName(),JSON.stringify(a))},readState:function(){var a=JSON.parse(window.localStorage.getItem(this.stateKeyName()));return a?a:null},getState:function(){var a=JSON.parse(window.localStorage.getItem(this.stateKeyName()));return a?(this.removeState(this.stateKeyName()),a):null},clearStates:function(){for(var a,b=new RegExp("^"+this.get("statePrefix")+"-.*","g"),c=[],d=0,e=window.localStorage.length;d<e;d++)a=window.localStorage.key(d),a.match(b)&&c.push(a);for(var f=0,g=c.length;f<g;f++)a=c[f],this.removeState(a);return c},stateKeyName:function(){return this.get("statePrefix")+"-"+this.get("state")},tokenKeyName:function(){return this.get("tokenPrefix")+"-"+this.get("providerId")},saveToken:function(a){window.localStorage.setItem(this.tokenKeyName(),JSON.stringify(a))},removeState:function(a){return a?window.localStorage.removeItem(a):window.localStorage.removeItem(this.stateKeyName())},removeToken:function(){return window.localStorage.removeItem(this.tokenKeyName())},getToken:function(){var a=JSON.parse(window.localStorage.getItem(this.tokenKeyName()));return a&&a.access_token?a:null},getAccessToken:function(){var a=this.getToken();return a?a.access_token:null},accessTokenIsExpired:function(){var a=this.getToken();return!a||this.now()>=a.expires_in},expireAccessToken:function(){var a=this.getToken();if(!a)return null;a.expires_in=0,this.saveToken(a)}});var d="1.1.0";c.OAuth2&&(c.OAuth2.version=d)});